AJS.toInit(function(C){var A,D;AJS.DragAndDrop.defaultDropHandler=function(G){if(!AJS.DragAndDropUtils.isGearsInstalledWithPermissions()){AJS.DragAndDropUtils.preventDefault(G);AJS.DragAndDropUtils.stopPropagation(G);return }var F=AJS.DragAndDropUtils.getFilesFromDropEvent(G);if(F&&!!F.length){B();var E=A.upload(F);if(!D){D=new AJS.DragAndDropProgressDialog();D.cancelListeners.push(function(I,H){A.cancel(H.workId)});AJS.DragAndDropUtils.enableDropZoneOn(C("#"+D.id)[0]);D.onShowListeners.push(function(){AJS.DragAndDropUtils.enableDropZoneOn(C(".blanket")[0])})}D.show();C.each(E,function(I,H){D.render(H)});AJS.DragAndDropUtils.getDesktopInstance().setDropEffect(G,"copy")}};function B(){if(!A){A=new AJS.GearsUploadManager(AJS.DragAndDropUtils.getCachingUrl("/download/resources/com.atlassian.confluence.plugins.drag-and-drop:upload-worker/upload-worker.js"));A.addOnErrorHandler(function(E){E.data.actionErrors&&E.data.actionErrors[0]&&D.renderError(E.workId,E.data.actionErrors[0])});A.addOnProgressHandler(function(E){D.renderUpdateToBytesUploaded(E.workId,E.bytesUploaded,E.fileSize)});A.addOnProgressHandler(function(){D.disableCloseButton(AJS.DragAndDrop.i18n["upload.in.progress"])});A.addOnSuccessHandler(function(E){D.renderComplete(E.workId)});A.addOtherMessageHandler(function(E){AJS.log("Received message from worker "+E.sender+": \n"+E.body)});A.addOnIdleHandler(function(){if(D.hasErrors()){D.enableCloseButton(AJS.DragAndDrop.i18n["dialog.button.done"])}else{D.closeButtonText(AJS.DragAndDrop.i18n["dialog.button.reload"]);setTimeout(function(){window.location.reload()},1000)}});A.addOnCancelHandler(function(E){D.renderCancelled(E)})}}});
AJS.toInit(function(A){AJS.DragAndDropUtils.init(function(){AJS.DragAndDropUtils.enableDropZoneOn(A("body")[0])})});
